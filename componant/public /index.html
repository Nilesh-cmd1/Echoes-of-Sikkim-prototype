<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Echoes of Sikkim — Static Viewer</title>
  <meta name="description" content="Static viewer for Echoes of Sikkim data" />

  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#6ee7b7; --text:#e6eef6;
      --card-shadow: 0 6px 18px rgba(0,0,0,.5);
    }
    html,body{height:100%; margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--text)}
    .wrap{max-width:1100px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    header h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:320px 1fr; gap:18px}
    .sidebar{background:var(--card);padding:12px;border-radius:10px;box-shadow:var(--card-shadow); height:calc(100vh - 120px); overflow:auto}
    .content{background:linear-gradient(180deg,#071023 0%, #081426 100%); padding:18px;border-radius:10px; box-shadow:var(--card-shadow); min-height:60vh; overflow:auto}
    .item{padding:10px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02); cursor:pointer; display:flex; gap:10px; align-items:center}
    .item:hover{background:rgba(255,255,255,0.04)}
    .thumb{width:64px;height:48px;object-fit:cover;border-radius:6px;background:#061227}
    .title{font-size:14px;margin:0}
    .meta{font-size:12px;color:var(--muted)}
    pre.jsondump{background:#021022;color:#d8f0ff;padding:10px;border-radius:6px;overflow:auto;max-height:320px}
    .top-controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .search{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    .btn{padding:8px 12px;border-radius:8px;background:var(--accent);color:#012; font-weight:600; cursor:pointer;border:none}
    @media (max-width:840px){
      .grid{grid-template-columns:1fr; }
      .sidebar{height:auto}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M12 2L15 8l6 1-4.5 4 1 6L12 17 4.5 19 5.5 13 1 9l6-1 3-6z" fill="currentColor" style="color:var(--accent)"/></svg>
      <div>
        <h1>Echoes of Sikkim — Static Viewer</h1>
        <div style="color:var(--muted);font-size:13px">Client-side renderer for your JSON data (drop manifest.json & JSON files in repo)</div>
      </div>
    </header>

    <div class="grid">
      <aside class="sidebar">
        <div class="top-controls">
          <input id="filter" class="search" placeholder="Search monasteries or pages..." />
          <button id="refresh" class="btn">Refresh</button>
        </div>

        <div id="list">
          Loading…
        </div>
      </aside>

      <main class="content" id="main">
        <div id="welcome">
          <h2>Welcome</h2>
          <p style="color:var(--muted)">Click an item on the left to load its JSON data and content. This viewer expects a <code>manifest.json</code> at the site root that lists your JSON files and metadata (example below).</p>

          <h3 style="margin-top:18px">Example manifest.json</h3>
          <pre class="jsondump">[
  {
    "slug": "lingdum-monastery",
    "title": "Lingdum Monastery",
    "summary": "A modern monastery in Sikkim",
    "json": "public/lingdum-monastery-meditation.json",
    "image": "public/lingdum-monastery-modern-arch.jpg"
  },
  {
    "slug": "pemayangtse",
    "title": "Pemayangtse Monastery",
    "summary": "Historic monastery near Pelling",
    "json": "public/pemayangtse-monastery-mountain.json",
    "image": "public/pemayangtse-monastery-mountain.jpg"
  }
]</pre>

          <p style="color:var(--muted)">Create `manifest.json` in the repository root (or in <code>public/</code>) and use the paths above exactly relative to your site root. Put your JSON files and images into the `public/` folder on GitHub so they are served statically.</p>
        </div>

        <div id="page" style="display:none">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">
            <img id="pageImage" src="" class="thumb" alt="" style="width:120px;height:80px" />
            <div>
              <h2 id="pageTitle" style="margin:0"></h2>
              <div id="pageSummary" class="meta"></div>
            </div>
          </div>

          <div id="pageBody" style="margin-top:12px"></div>

          <h4 style="margin-top:18px">Raw JSON</h4>
          <pre id="raw" class="jsondump"></pre>
        </div>
      </main>
    </div>
  </div>

  <script>
    // Configuration: where to fetch the manifest
    const MANIFEST_PATH = './manifest.json'; // put manifest.json into repo root or public/

    const listEl = document.getElementById('list');
    const filterInput = document.getElementById('filter');
    const refreshBtn = document.getElementById('refresh');
    const welcome = document.getElementById('welcome');
    const page = document.getElementById('page');
    const pageTitle = document.getElementById('pageTitle');
    const pageSummary = document.getElementById('pageSummary');
    const pageBody = document.getElementById('pageBody');
    const pageImage = document.getElementById('pageImage');
    const rawEl = document.getElementById('raw');

    let items = [];

    async function fetchManifest() {
      listEl.innerHTML = 'Loading manifest…';
      try {
        const r = await fetch(MANIFEST_PATH);
        if (!r.ok) throw new Error('manifest not found ('+r.status+')');
        const m = await r.json();
        if (!Array.isArray(m)) throw new Error('manifest must be an array');
        items = m;
        renderList(items);
      } catch (err) {
        listEl.innerHTML = '<div style="color:#ff8080;padding:10px">Error loading manifest: ' + err.message + '</div>';
      }
    }

    function renderList(data) {
      if (!data || data.length === 0) {
        listEl.innerHTML = '<div style="color:var(--muted);padding:10px">No items found in manifest.json</div>';
        return;
      }
      const q = filterInput.value.trim().toLowerCase();
      const filtered = data.filter(it => {
        return !q || (it.title && it.title.toLowerCase().includes(q)) || (it.slug && it.slug.toLowerCase().includes(q)) || (it.summary && it.summary.toLowerCase().includes(q));
      });

      listEl.innerHTML = filtered.map(it => `
        <div class="item" data-json="${encodeURIComponent(it.json||'')}" data-title="${escapeHtml(it.title||'')}" data-summary="${escapeHtml(it.summary||'')}" onclick="loadItem('${encodeURIComponent(it.json||'')}', '${escapeHtml(it.title||'')}', '${escapeHtml(it.image||'')}', '${escapeHtml(it.summary||'')}')">
          <img class="thumb" src="${it.image||''}" alt="">
          <div style="flex:1">
            <div class="title">${it.title||'(no title)'}</div>
            <div class="meta">${it.summary||''}</div>
          </div>
        </div>
      `).join('');
    }

    // helper to escape single quotes for onclick params
    function escapeHtml(s){
      if(!s) return '';
      return s.replace(/'/g, "\\'").replace(/"/g,'&quot;').replace(/\n/g,' ');
    }

    async function loadItem(jsonPathEnc, title, image, summary) {
      const jsonPath = decodeURIComponent(jsonPathEnc);
      welcome.style.display = 'none';
      page.style.display = 'block';
      pageTitle.textContent = title || 'Item';
      pageSummary.textContent = summary || '';
      pageImage.src = image || '';

      rawEl.textContent = 'Loading…';
      pageBody.innerHTML = '<p style="color:var(--muted)">Loading content...</p>';

      try {
        const r = await fetch(jsonPath);
        if(!r.ok) throw new Error('JSON not found ('+r.status+')');
        const data = await r.json();
        rawEl.textContent = JSON.stringify(data, null, 2);
        // Render the JSON in HTML — this is a flexible, generic rendering.
        pageBody.innerHTML = renderDataAsHtml(data);
      } catch(err) {
        rawEl.textContent = 'Error: ' + err.message;
        pageBody.innerHTML = '<div style="color:#ff9a9a">Failed to load JSON: ' + err.message + '</div>';
      }

      // scroll to top of content on load
      page.scrollTop = 0;
    }

    function renderDataAsHtml(data){
      // If your JSON contains a "content" field with HTML or markdown, prefer that.
      if (!data) return '<div style="color:var(--muted)">No data</div>';

      // If `data.content` is HTML, show it (be careful with untrusted HTML).
      if (typeof data.content === 'string' && /<\/?[a-z][\s\S]*>/i.test(data.content)) {
        return data.content;
      }

      // If data has fields like title / description / body etc, render nicely
      const parts = [];
      if (data.title) parts.push(`<h3>${escapeText(data.title)}</h3>`);
      if (data.description) parts.push(`<p class="meta">${escapeText(data.description)}</p>`);
      if (data.body) parts.push(`<div>${escapeText(data.body).replace(/\\n/g,'<br>')}</div>`);

      // If there's a list of sections or items, render them
      if (Array.isArray(data.sections)) {
        parts.push('<div>');
        for (const s of data.sections) {
          parts.push(`<section style="padding:10px 0;border-top:1px dashed rgba(255,255,255,0.03)">`);
          if (s.heading) parts.push(`<h4>${escapeText(s.heading)}</h4>`);
          if (s.text) parts.push(`<p>${escapeText(s.text)}</p>`);
          parts.push('</section>');
        }
        parts.push('</div>');
      }

      // If data is an object with many key-values, show a table
      if (Object.keys(data).length > 0 && parts.length === 0) {
        parts.push('<table style="width:100%;border-collapse:collapse">');
        for (const k of Object.keys(data)) {
          const v = data[k];
          if (typeof v === 'object') continue;
          parts.push(`<tr><td style="padding:6px 8px;border-bottom:1px dashed rgba(255,255,255,0.02);width:180px;color:var(--muted)">${escapeText(k)}</td><td style="padding:6px 8px;border-bottom:1px dashed rgba(255,255,255,0.02)">${escapeText(String(v))}</td></tr>`);
        }
        parts.push('</table>');
      }

      // If it's mostly structured, and nothing matched, show a JSON preview
      if (parts.length === 0) {
        parts.push(`<pre class="jsondump">${escapeText(JSON.stringify(data, null, 2))}</pre>`);
      }

      return parts.join('');
    }

    function escapeText(s){
      return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    // Wire up filter and refresh
    filterInput.addEventListener('input', () => renderList(items));
    refreshBtn.addEventListener('click', fetchManifest);

    // Start on load
    fetchManifest();
  </script>
</body>
</html>
